deploy:
  needs: tests
  if: github.ref == 'refs/heads/main'
  runs-on: ubuntu-latest

  steps:
    - uses: actions/checkout@v4

    - name: Setup Heroku CLI
      uses: heroku/actions/setup@v2
      with:
        heroku_api_key: ${{ secrets.HEROKU_API_KEY }}

    - name: Configure git user
      run: |
        git config user.email "${{ secrets.HEROKU_USER_EMAIL }}"
        git config user.name "github-actions[bot]"

    - name: Add Heroku remote
      run: heroku git:remote -a ${{ secrets.HEROKU_APP_NAME }}

    - name: Deploy to Heroku
      run: git push --force heroku HEAD:main
